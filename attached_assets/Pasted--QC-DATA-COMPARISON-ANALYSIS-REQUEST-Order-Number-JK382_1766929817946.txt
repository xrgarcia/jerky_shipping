=== QC DATA COMPARISON ANALYSIS REQUEST ===

Order Number: JK3825357775
Shipment ID: 99f871f6-46ce-44c6-815b-ef651ec88b37

--- SUMMARY ---
Total Differences: 2
Missing in Local (ship.): 1
Missing in SkuVault: 1
Quantity Mismatches: 0

--- LOCAL DATA (shipment_qc_items table) ---
SKU | Barcode | Description | Qty
JCB-BEJ-130-16 | 811007029976 | Limited Edition - Prime Rib Beef Jerky - 2.5 oz. | 1
JCB-SS-172-13-X6 | 4000003681 | Spiced Apple Snack Stick - 6 Pack | 1
JCB-TK-SHBJS | 850073089101 | 4 pc. Steakhouse Beef Jerky Sampler | 1

--- SKUVAULT LIVE DATA (QC Sale API) ---
SKU | Barcode | Title | Qty
JCB-BEJ-130-16 | 811007029976 | Limited Edition - Prime Rib Beef Jerky - 2.5 oz. | 1
JCB-TK-SHBJS | 850073089101 | 4 pc. Steakhouse Beef Jerky Sampler | 1
JCB-SS-172-13 | 4000003674 | Spiced Apple Snack Stick - 1 oz. | 6

--- SKUVAULT RAW ITEMS (with inventory levels) ---
SKU | Is Kit? | Qty On Hand | Kit Components
JCB-BEJ-130-16 | no | N/A | none
JCB-TK-SHBJS | no | N/A | none
JCB-SS-172-13-X6 | YES | N/A | JCB-SS-172-13x6

--- DETAILED DIFFERENCES WITH DIAGNOSIS ---
SKU | Field | Local Value | SkuVault Value | Diagnosis Category | Diagnosis Reason
JCB-SS-172-13 | item | (missing) | qty: 6 | INDIVIDUAL_MISSING_LOCAL | Individual product exists in catalog but not in local QC items. May not have been included in shipment sync.
JCB-SS-172-13-X6 | item | qty: 1 | (missing) | KIT_MAPPING_MISMATCH | This SKU is a component of kit(s): [JCB-BEJ-APL-BNDL, JCB-SS-172-13-X12, JCB-SS-172-13-X24 + 1 more]. Local kit_mappings_cache has this as a component but SkuVault QC response doesn't include it. Kit definition may differ between systems. (Parent: JCB-BEJ-APL-BNDL)

--- PRODUCT CATALOG INFO (from skuvault_products table) ---
SKU | Category | Is AP? | DUAL FLAG? | Parent SKU | In Catalog? | Kit Components | Member of Kits
JCB-BEJ-130-16 | Beef Jerky | no | ok | null | yes | none | JCB-BEJ-130-16-2X, JCB-BEJ-130-16-5X, JCB-BSBB-OBPT+PRO, JCB-TK-3YAB, JCB-TK-3YAB-2
JCB-SS-172-13-X6 | Meat Sticks | no | ok | null | yes | JCB-SS-172-13x6 | JCB-BEJ-APL-BNDL, JCB-SS-172-13-X12, JCB-SS-172-13-X24, JCB-SS-172–173-13-X12
JCB-TK-SHBJS | General | no | ok | null | yes | JCB-BEJ-126-1x1, JCB-BEJ-127-1x1, JCB-BEJ-128-1x1, JCB-BEJ-129-1x1, JCB-CMB-SHJC-POUCHx1 | none
JCB-SS-172-13 | Meat Sticks | no | ok | null | yes | none | JCB-SS-172-13-X6

--- BUSINESS RULES: KITS vs ASSEMBLED PRODUCTS (APs) ---
KITS = Built at fulfillment time by picker. EXPLODED into components. Should have category='kit'.
APs = Pre-built products, ship as-is. NOT exploded. Have is_assembled_product=true.

--- HOW shipment_qc_items GETS POPULATED ---
When orders sync to ship., the QC item hydrator populates shipment_qc_items:
1. Products with product_category='kit' → EXPLODED into component SKUs using kit_mappings_cache
2. Variants (where sku != parent_sku) → Stored as-is (the variant SKU)
3. Regular products → Stored as-is
4. Products with is_assembled_product=true but category != 'kit' → NOT exploded (stored as parent SKU)

SkuVault (golden source) determines what actually gets exploded at fulfillment time.
If SkuVault explodes a product but ship. didn't, the product is miscategorized in the catalog.

--- CONTEXT ---
- 'Local' = ship. database (shipment_qc_items table, populated when orders are synced)
- 'SkuVault' = Live data from SkuVault QC Sale API (GOLDEN SOURCE for what picker scans)
- 'Missing in Local' = SKUs exist in SkuVault but not in our shipment_qc_items
- 'Missing in SkuVault' = SKUs exist in local but SkuVault QC API doesn't return them
- 'Is AP' = isAssembledProduct flag (pre-built products, should NOT be exploded)
- 'Category' = product_category ('kit' = should be exploded at fulfillment)
- Kit Components = Expected components from kit_mappings_cache (sourced from GCP reporting DB)

--- COMMON ISSUES ---
1. **DUAL FLAG CONFLICT**: Product has BOTH product_category='kit' AND is_assembled_product=true
   - This is INVALID - a product must be EITHER a kit (exploded) OR an AP (not exploded)
   - Causes unpredictable behavior: ship. may explode using kit mappings while SkuVault treats as AP
   - FIX: Remove one flag. If it should be exploded, keep category='kit' and set is_assembled_product=false
   - FIX: If it should ship as-is, set category to something else and keep is_assembled_product=true
2. MISCATEGORIZED PRODUCT: Local has parent SKU, SkuVault has components
   - Product has is_assembled_product=true but category != 'kit'
   - SkuVault exploded it (treating as kit) but ship. didn't
   - FIX: Update product to have product_category='kit' in the source catalog
3. MISSING KIT MAPPING: Product is category='kit' but no components in kit_mappings_cache
   - The kit definition may not exist in GCP vw_internal_kit_component_inventory_latest view
4. STALE KIT MAPPING: Components don't match between local and SkuVault
   - Kit definition changed in SkuVault but kit_mappings_cache has old data
   - Cache refreshes hourly from GCP reporting database