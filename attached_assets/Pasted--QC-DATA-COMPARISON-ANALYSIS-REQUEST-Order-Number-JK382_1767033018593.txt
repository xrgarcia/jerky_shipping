=== QC DATA COMPARISON ANALYSIS REQUEST ===

Order Number: JK3825357906
Shipment ID: fe5359c1-f943-48a1-90a8-b15f26f9e410

--- SUMMARY ---
Total Differences: 2
Missing in Local (ship.): 1
Missing in SkuVault: 1
Quantity Mismatches: 0

--- LOCAL DATA (shipment_qc_items table) ---
SKU | Barcode | Description | Qty
JCB-ELJ-1-17 | 811007027071 | Jerky.com - Original Elk Jerky - 1.75 oz. | 1
JCB-OSJ-1-17 | 811007029143 | Jerky.com - Original Ostrich - 1.75 oz. | 1
JCB-TUJ-2-16-X2 | JCB-TUJ-2-16-X2 | All-Natural Turkey Jerky - Teriyaki / Double the Meat - 2 Packs - (Savings!) | 1

--- SKUVAULT LIVE DATA (QC Sale API) ---
SKU | Barcode | Title | Qty
JCB-ELJ-1-17 | 811007027071 | Jerky.com - Original Elk Jerky - 1.75 oz. | 1
JCB-OSJ-1-17 | 811007029143 | Jerky.com - Original Ostrich - 1.75 oz. | 1
JCB-TUJ-2-16 | 811007027156 | Jerky.com - Teriyaki Turkey Jerky - 2.5 oz. | 2

--- SKUVAULT RAW ITEMS (with inventory levels) ---
SKU | Is Kit? | Qty On Hand | Kit Components
JCB-ELJ-1-17 | no | N/A | none
JCB-OSJ-1-17 | no | N/A | none
JCB-TUJ-2-16-X2 | YES | N/A | JCB-TUJ-2-16x2

--- DETAILED DIFFERENCES WITH DIAGNOSIS ---
SKU | Field | Local Value | SkuVault Value | Diagnosis Category | Diagnosis Reason
JCB-TUJ-2-16 | item | (missing) | qty: 2 | INDIVIDUAL_MISSING_LOCAL | Individual product exists in catalog but not in local QC items. May not have been included in shipment sync.
JCB-TUJ-2-16-X2 | item | qty: 1 | (missing) | KIT_MAPPING_MISMATCH | This is a kit that was in local QC items as parent SKU, but SkuVault exploded it into components. Check if kit explosion is working correctly locally.

--- PRODUCT CATALOG INFO (from skuvault_products table) ---
SKU | Category | Is AP? | DUAL FLAG? | Parent SKU | In Catalog? | Kit Components | Member of Kits
JCB-ELJ-1-17 | Exotic Jerky | no | ok | null | yes | none | EXOTIC-X4, EXOTIC-X6, EXOTIC-X8
JCB-OSJ-1-17 | Exotic Jerky | no | ok | null | yes | none | EXOTIC-X6, EXOTIC-X8
JCB-TUJ-2-16-X2 | kit | no | ok | null | yes | none | none
JCB-TUJ-2-16 | Turkey Jerky | no | ok | null | yes | none | none

--- BUSINESS RULES: KITS vs ASSEMBLED PRODUCTS (APs) ---
KITS = Built at fulfillment time by picker. EXPLODED into components. Should have category='kit'.
APs = Pre-built products, ship as-is. NOT exploded. Have is_assembled_product=true.

--- HOW shipment_qc_items GETS POPULATED ---
When orders sync to ship., the QC item hydrator populates shipment_qc_items:
1. Products with product_category='kit' → EXPLODED into component SKUs using kit_mappings_cache
2. Variants (where sku != parent_sku) → Stored as-is (the variant SKU)
3. Regular products → Stored as-is
4. Products with is_assembled_product=true but category != 'kit' → NOT exploded (stored as parent SKU)

SkuVault (golden source) determines what actually gets exploded at fulfillment time.
If SkuVault explodes a product but ship. didn't, the product is miscategorized in the catalog.

--- CONTEXT ---
- 'Local' = ship. database (shipment_qc_items table, populated when orders are synced)
- 'SkuVault' = Live data from SkuVault QC Sale API (GOLDEN SOURCE for what picker scans)
- 'Missing in Local' = SKUs exist in SkuVault but not in our shipment_qc_items
- 'Missing in SkuVault' = SKUs exist in local but SkuVault QC API doesn't return them
- 'Is AP' = isAssembledProduct flag (pre-built products, should NOT be exploded)
- 'Category' = product_category ('kit' = should be exploded at fulfillment)
- Kit Components = Expected components from kit_mappings_cache (sourced from GCP reporting DB)

--- COMMON ISSUES ---
1. **DUAL FLAG CONFLICT**: Product has BOTH product_category='kit' AND is_assembled_product=true
   - This is INVALID - a product must be EITHER a kit (exploded) OR an AP (not exploded)
   - Causes unpredictable behavior: ship. may explode using kit mappings while SkuVault treats as AP
   - FIX: Remove one flag. If it should be exploded, keep category='kit' and set is_assembled_product=false
   - FIX: If it should ship as-is, set category to something else and keep is_assembled_product=true
2. MISCATEGORIZED PRODUCT: Local has parent SKU, SkuVault has components
   - Product has is_assembled_product=true but category != 'kit'
   - SkuVault exploded it (treating as kit) but ship. didn't
   - FIX: Update product to have product_category='kit' in the source catalog
3. MISSING KIT MAPPING: Product is category='kit' but no components in kit_mappings_cache
   - The kit definition may not exist in GCP vw_internal_kit_component_inventory_latest view
4. STALE KIT MAPPING: Components don't match between local and SkuVault
   - Kit definition changed in SkuVault but kit_mappings_cache has old data
   - Cache refreshes hourly from GCP reporting database